#!/usr/bin/env bash

function main {
  if [[ -x ".script/deploy" ]]; then
    if [[ -z "${DEPLOY_IN_STUB:-}" ]]; then
      export DEPLOY_IN_STUB=1
      exec ".script/deploy" "$@"
      return 1
    fi
  fi

  case "${!#}" in
    *.yml|*.yaml)
      true
      ;;

    *)
      set -- "$@" site.yml
      ;;
  esac

  exec ansible-playbook -e project_git_repo=$(git config --local remote.origin.url) -l "empty-$RANDOM" ${opt_ansible:+"${opt_ansible[@]}"} "$@"
}

source sub "$0" "$@"
