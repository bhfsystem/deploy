#!/usr/bin/env bash

function main {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"

  if [[ -x ".script/deploy" ]]; then
    if [[ -z "${DEPLOY_IN_STUB:-}" ]]; then
      export DEPLOY_IN_STUB=1
      exec ".script/deploy" "$@"
      return 1
    fi
  fi

  case "${!#}" in
    *.yml|*.yaml)
      true
      ;;

    *)
      set -- "$@" site.yml
      ;;
  esac

  source "$BLOCK_PATH/block/script/profile" ''
  require
  exec ansible-playbook -e project_git_repo=$(git config --local remote.origin.url) ${opt_ansible:+"${opt_ansible[@]}"} "$@"
}

source sub "$0" "$@"
