#!/usr/bin/env bash

function main {
  export ANSIBLE_SSH_ARGS="-o ForwardAgent=yes"

  local opt_ansible=()
  if [[ -x "script/inventory" ]]; then
    opt_ansible=(-i ./script/inventory)
  fi

  case "${!#}" in
    *.yml|*.yaml)
      true
      ;;

    *)
      set -- "$@" site.yml
      ;;
  esac

  exec ansible-playbook -e project_git_repo=$(git config --local remote.origin.url) -l "empty-$RANDOM" ${opt_ansible:+"${opt_ansible[@]}"} "$@"
}

source sub "$0" "$@"
